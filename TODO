TODO
====

There are loads of TODO/XXX items in the source, grep them!


GENERAL
-------

Register devices, CPUs and buffers into the vk_machine_t. Makes managing them
a lot easier.

Save state support. Partially implemented in a branch.

Add support for "required" field in the JSON file.

For later, write an event-driven scheduler.

I'm seriously thinking about slowling "porting" valkyrie to C++... Mmm.


HIKARU
------

Move the slave GPU access to hikaru-gpu.c. Proper support may require the
introduction of a new vk_device_accessors_t class.

Proper MIE emulation (wrap a Z80 emulator in a vk_cpu_t sub-class and tape
it to the code.)

Proper AICA emulation (especially the RTC and IRQs.)

Implement the three EEPROMs (MAINBD, ROMBD, MIE.)


SH-4
----

Import the LLVM jit core into valkyrie. Still a bit rough on the edges, but
already faster than the interpreter.


RENDERING
---------

The projection clipping planes are probably scaled by some value, because
using the ones provided by the games as they are leads to a far too close
far clipping plane. Use 'p' to toggle a standard 90 degree FOV projection and
see things (affects all games).

Implement proper model caching using VBOs.

Implement deferred rendering based on polygon types (a la PVR/dreamcast).

Once models are drawn in the correct order, fix any remaining issues with the
alpha.

Figure out how the fade-in effect is done in PH intro screen (GPU instructions
781, 181).

Figure out the parameters controlling the alpha in instanced rendering (used
heavily in BRAVEFF).

Figure out fogging (most likely determined by instruction 691).


AIRTRIX
-------

Attract mode works.

No controls, no sound, serious graphical glitches.

Emulation wise, the biggest issue is with the player character: it is not
animated. Talking with the Demul guys, we figured out the following: the game
uploads matrix data to CMDRAM  48100000-48100E2x, along with commands, but we
don't know what device that data is for. It is written by the master SH-4 but
never reads them back, and there is strong evidence that the slave SH-4 does
not touch them ever. The matrices come along with a pointer to a GPU routine in
CMDRAM (in master-SH-4-address-space-format), which, guess what?, draws the
player character. I *think* they specify additional transformations to be
applied to the skater body parts, but I don't know yet how.


BRAVEFF
-------

The title screen and intro work. Freezes after that.

No controls, no sound, serious graphical glitches.

The game supplies textures in twiddled format (thanks to the Demul authors for
the info), which valkyrie does not yet support.

Characters are not drawn (either the data is not there, or the modelview
matrices I'm using are the wrong ones; if the former, it may be a master-slave
synchronization error).

References:
 http://www.youtube.com/watch?v=rwzzj7dzxE8


Cyber Troops Virtual On 4
-------------------------

Not dumped yet.


PHARRIER
--------

Attract mode works.

No controls, no sound, serious graphical glitches.

3D hiccups, don't know yet why (strategy: monitor writes to CMDRAM, TMU, IRQs,
and reads from GPU ports -- the reason lies there).

The 2D is in ABGR8888 format, but it doesn't always work. It also plays bad
with blending, and I do not know which GPU port controls that.

Makes use of A8 textures, which are implemented wrong.

References:
 http://www.youtube.com/watch?v=_kED3wt6p90
 http://www.youtube.com/watch?v=VCVnNBkeRX8


PODRACE
-------

Missing MASKROMS. Won't work.


SGNASCAR
--------

Attract mode works.

Makes use of conditional control-flow in the GPU program (most likely for
model LOD selection), which isn't reversed yet, 

The BOOTROM (all version) reads from invalid memory regions when loading the
game data from ROM to RAM; that is likely a game bug.

References:
 http://www.youtube.com/watch?v=N2rPqafQr84
